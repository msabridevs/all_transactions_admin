
<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>طلبات المعاملات القنصلية</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <script>
    const SUPABASE_URL = 'https://esbgozuigjdavcxiaxon.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVzYmdvenVpZ2pkYXZjeGlheG9uIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQyMjU4NzUsImV4cCI6MjA1OTgwMTg3NX0.OiOH_0ZcTUPu6oMGILsq5oqm1FdCDBvzcHozs-4DNY0';
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    async function init() {
      const { data: { session } } = await supabase.auth.getSession();
      if (session) {
        const allowedEmails = ['egypt.in.frankfurt@gmail.com'];
        const userEmail = session.user.email;
        if (!allowedEmails.includes(userEmail)) {
          await supabase.auth.signOut();
          alert('❌ هذا الحساب غير مصرح له بالدخول.');
        } else {
          document.getElementById('auth-section').style.display = 'none';
          document.getElementById('app-section').style.display = 'block';
          alert('✅ تم تسجيل الدخول بنجاح');
        }
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById('google-login-btn').onclick = async () => {
        const { error } = await supabase.auth.signInWithOAuth({
          provider: 'google',
          options: {
            redirectTo: `${window.location.origin}/`
          }
        });
        if (error) alert('فشل تسجيل الدخول عبر Google: ' + error.message);
      };

      init();
    });
  </script>
</head>
<body>
  <h2>طلبات المعاملات القنصلية</h2>
  <div id="auth-section">
    <button id="google-login-btn" style="padding: 12px; font-size: 18px; background: #4285F4; color: white; border: none; border-radius: 5px; cursor: pointer;">
      تسجيل الدخول باستخدام Gmail
    </button>
  </div>

  <div id="app-section" style="display:none;">
    <button onclick="supabase.auth.signOut().then(() => location.reload())">تسجيل الخروج</button>
    <p>مرحبًا بك في التطبيق بعد تسجيل الدخول.</p>
  </div>
</body>
</html>
